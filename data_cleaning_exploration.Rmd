---
title: "Data Cleaning Exploration"
author: "Phoebe Abramowitz"
date: "3/4/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library("tidyverse")
```

Upload Files:
```{r}
setwd("~/Desktop/Berkeley/Spring19/stat_154/154project")
source("./data_cleaning .R")
```

Network retrieved data until the end but sometimes the connection failed, logger has data from when the connection failed but not always until the end

```{r}
#Ask how to read this, or manually change the format into something I can read with delim then cut 
#datetime <- read.delim("./data/sonoma-dates", header=FALSE)
```
Temperature:
```{r}
#why are min & max NA? Doesnt matter becuase summary accurately gives min and max
range(data_net$humid_temp)
range(data_log$humid_temp)
#similar mean and median, exist in same reasonable scale except outliers
summary(data_net$humid_temp)
summary(data_log$humid_temp)
ggplot(data_net, aes(x=humid_temp)) + geom_histogram()
ggplot(data_log, aes(x=humid_temp)) + geom_histogram()
```
Relative Humidity:
```{r}
range(data_net$humidity)
range(data_log$humidity)
summary(data_net$humidity)
#Same Scale just with crazy lower outlier
summary(data_log$humidity)
ggplot(data_net, aes(x=humidity)) + geom_histogram()
ggplot(data_log, aes(x=humidity)) + geom_histogram()
```
Incident PAR:hamatop? wavelength from 350 to 700 nm
```{r}
#range for net is in the 90s, for log in the 40s
range(data_net$hamatop)
range(data_log$hamatop)
summary(data_net$hamatop)
summary(data_log$hamatop)
ggplot(data_net, aes(x=hamatop)) + geom_histogram()
ggplot(data_log, aes(x=hamatop)) + geom_histogram()
```
Reflective PAR:check column use here?
```{r}
range(data_net$hamabot)
range(data_log$hamabot)
summary(data_net$hamabot)
#similar in scale except for Max. >1/2 zeros bc median=0
summary(data_log$hamabot)
ggplot(data_net, aes(x=hamabot)) + geom_histogram()
ggplot(data_log, aes(x=hamabot)) + geom_histogram()
```
Voltage-measure of Battery:
```{r}
range(data_net$voltage)-range(data_log$voltage)
#range of voltage is very inconsistant
#voltage is clearly different scales between log and net
#loig data matches the paper
```
epoch, nodeid, result_time-Distinguishing between points
```{r}
#range of epoch is very inconsistant, why?
range(data_net$epoch)-range(data_log$epoch)

#Why does nodeid go so high in log?-Just one nodeid is extremely wrong. Look at that Data point
summary(data_log$nodeid)
log_nodeid_outlier <- filter(data_log, nodeid>60000)
log_nodeid_outlier
#manually take out single outlier, shows nothign else is above 200, which is correct
data_log_ex <- filter(data_log, nodeid<60000)
#inconsistant number of instances per node
ggplot(data_log_ex, aes(x=nodeid)) + geom_histogram(bindwidth=5)
```
Choose to combine net and log Either can work to become the "Main Table"
```{r}
#First need to equate ranges, as above

#concatenate everything in data_net with everything in data_log that isn't in data_net, defined by epoch and nodeid
library(dplyr)
data_log$result_time
just_log <- anti_join(data_log, data_net, by = c("nodeid" = "nodeid", "epoch" = "epoch"))
#what to do about the essentially lack of result_time in data_log
data_main <- full_join(data_net, just_log )
```

What is epoch?
Are all the missing Values NA? How to get range to stop giving NA
When should zero values be NAs?
How to use the HUmid adjustment column?

_____________________________________
Voltage:
range for data_net is 198-1023
range for data_log is 0.009 - 3.03
range for data_all is 0.009 - 1023
Maybe because the log is a physical node located at the redwood tree, while the net data was transferred through the GPRS? (prob not but I asked my bro)

ATmega128 has a 10-bit ADC operating on 4.5 - 5.5V (http://ww1.microchip.com/downloads/en/DeviceDoc/doc2467.pdf)

5V is assumed to be 1023, use the following equation of ratios for the conversion.
(https://learn.sparkfun.com/tutorials/analog-to-digital-conversion/relating-adc-value-to-voltage)

1023/5 = ADC reading/analog voltage measured

I think ADC reading is the voltage value in data_net, and 'analog voltage measured is' what we want to convert to

Hence the formula we should use to convert data_net voltage is as follows:
x = (5*data_net reading) / 1023
```{r}
test <- data_net %>%
  mutate("converted_voltage" = data_net$voltage*12.33 / 1023) %>%
  select(c("voltage", "converted_voltage"))

summary(test$converted_voltage)
summary(data_log$voltage)

```

________________________________________
result time in data log are all exactly the same. There are different node IDs and epochs across the nodeid's, but there are some repeats with slight variation in humidity or temp or depth.. wtf is going on? 

```{r}

length(unique(data_net$nodeid))

length(unique(data_log$nodeid))
```

just checking if this works

