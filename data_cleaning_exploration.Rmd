---
title: "Data Cleaning Exploration"
author: "Phoebe Abramowitz"
date: "3/4/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Upload Files:
```{r}
setwd("~/Desktop/Berkeley/Spring19/stat_154/154project")
source("./data_cleaning .R")
```

Network retrieved data until the end but sometimes the connection failed, logger has data from when the connection failed but not always until the end

```{r}
#Ask how to read this, or manually change the format into something I can read with delim then cut 
#datetime <- read.delim("./data/sonoma-dates", header=FALSE)
```
Temperature:
```{r}
library(ggplot2)
library(dplyr)
#why are min & max NA? Doesnt matter becuase summary accurately gives min and max
range(data_net$humid_temp)
range(data_log$humid_temp)
#similar mean and median, exist in same reasonable scale except outliers
summary(data_net$humid_temp)
summary(data_log$humid_temp)
ggplot(data_net, aes(x=humid_temp)) + geom_histogram()
ggplot(data_log, aes(x=humid_temp)) + geom_histogram()
```
Relative Humidity:
```{r}
range(data_net$humidity)
range(data_log$humidity)
summary(data_net$humidity)
#Same Scale just with crazy lower outlier
summary(data_log$humidity)
ggplot(data_net, aes(x=humidity)) + geom_histogram()
ggplot(data_log, aes(x=humidity)) + geom_histogram()
```
Incident PAR:hamatop? 
```{r}
# > half zero, implies PAR becuase was done before the solstice so usually no sun
summary(data_net$hamatop)
#massive outlier(s) on the max in log
summary(data_log$hamatop)

#ONLY RUN THIS ONCE, following link 
data_net$hamatop <- data_net$hamatop*0.0185
data_net$hamabot <- data_net$hamabot*0.0185
data_log$hamatop <- data_log$hamatop*0.0185
data_log$hamabot <- data_log$hamabot*0.0185


ggplot(data_net, aes(x=hamatop)) + geom_histogram()
ggplot(data_log, aes(x=hamatop)) + geom_histogram()
```
Reflective PAR:check column use here?
```{r}
range(data_net$hamabot)
range(data_log$hamabot)
summary(data_net$hamabot)
#massive outlier(s) on the max in log
summary(data_log$hamabot)
ggplot(data_net, aes(x=hamabot)) + geom_histogram()
ggplot(data_log, aes(x=hamabot)) + geom_histogram()
```
Voltage-measure of Battery:
```{r}
range(data_net$voltage)-range(data_log$voltage)
#voltage is clearly different scales between log and net
#log data matches the paper
#convert net data to match the paper
test <- data_net %>%
  mutate("converted_voltage" = data_net$voltage*12.33 / 1023)

data_net$voltage = data_net$voltage*12.33 / 1023
summary(data_net$voltage)
summary(test$converted_voltage)
```
epoch, nodeid, result_time-Distinguishing between points
```{r}
#range of epoch is very inconsistant, why?
range(data_net$epoch)-range(data_log$epoch)
summary(data_log$epoch)
summary(data_net$epoch)
#Why does nodeid go so high in log?-Just one nodeid is extremely wrong. Look at that Data point
summary(data_log$nodeid)
log_nodeid_outlier <- filter(data_log, nodeid>60000)
log_nodeid_outlier
#manually take out single outlier, shows nothign else is above 200, which is correct
data_log_ex <- filter(data_log, nodeid<60000)
#inconsistant number of instances per node
ggplot(data_log_ex, aes(x=nodeid)) + geom_histogram(bindwidth=5)
summary(data_log_ex$nodeid)

summary(data_net$nodeid) #without outlier in log, they're similar ranges and scales
ggplot(data_net, aes(x=nodeid)) + geom_histogram(binwidth=5)
```
Choose to combine net and log Either can work to become the "Main Table"
```{r}
#First need to equate ranges, as above

#concatenate everything in data_net with everything in data_log that isn't in data_net, defined by epoch and nodeid
library(dplyr)
data_log$result_time
just_log <- anti_join(data_log, data_net, by = c("nodeid" = "nodeid", "epoch" = "epoch"))
#what to do about the essentially lack of result_time in data_log
data_main <- full_join(data_net, just_log)
data_main <- data_main[,1:11]
```

```{r}
# trying to reconcile the duplicate values of nodeid and epoch

data_main %>%
  group_by(nodeid) %>%
  group_by(epoch) %>%
  summarise()
```
```{r}
# number of unique epochs roughly matches the number of observations recorded per mote
length(unique(data_main$epoch))
length(unique(data_main$nodeid))
```


ANSWERED We chose adjusted humidity becuase it matches the max in the report, and it's importatn to adjust for teemp

Are all the missing values NA? 
  When should zero values be NAs?

ANSWERED How to use the Humid adjustment column?- As humidity? YES

In log, why is epoch+nodeid is not a unique descriptor of row? Within these rows with same epoch & nodeid, there's variation between voltage, humid_temp, humidity, humid_adjust.
  What is epoch?- Sample Number
  If we group by epoch + nodeid, what happens?
  Why are there so many unique nodeids? 31 for net but 72 (extra) for log, paper says there's 33     sensors. 
  Why do numbers go up to 200? Do the numbers matter, hopefully not?

ANSWERED(for now)Voltage Conversion? 

ANSWERED check that humid_temp summary matches the paper 

ANSWEREDHamatop&hamabot- incident and reflective, respectively?   
ANWERED: hamatop and hamabot need Lux to PPFD conversion in order to be consistent with the paper. 
 Lux to PPFD(Âµmol m-2 s-1, used in the paper): 0.0185
 Lux of full sunlight is 108,000, consistant with the maximum numbers in 

We're choosing to combine then deal with most outliers: justify this

Choosing to deal with duplicate epoch nodeid after joining